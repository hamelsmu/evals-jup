{"version":3,"file":"lib_index_js.0cd05c16f889cdf79cd5.js","mappings":"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","sources":["webpack://jupyvibe/./src/cellTypeSwitcher.tsx","webpack://jupyvibe/./src/index.ts","webpack://jupyvibe/./src/kernelConnector.ts","webpack://jupyvibe/./src/modelPicker.tsx","webpack://jupyvibe/./src/promptCell.ts","webpack://jupyvibe/./src/promptModel.ts","webpack://jupyvibe/./src/promptParser.ts","webpack://jupyvibe/./src/settings.ts","webpack://jupyvibe/./src/tokens.ts","webpack://jupyvibe/./src/toolResultRenderer.ts"],"sourcesContent":["/**\n * Custom cell type switcher that adds \"Prompt\" option to the dropdown.\n * \n * Replaces the default JupyterLab cell type switcher via IToolbarWidgetRegistry.\n */\n\nimport * as React from 'react';\nimport { ReactWidget } from '@jupyterlab/ui-components';\nimport { NotebookPanel, NotebookActions, Notebook } from '@jupyterlab/notebook';\nimport { ITranslator, nullTranslator } from '@jupyterlab/translation';\nimport * as nbformat from '@jupyterlab/nbformat';\nimport type { IPromptCellManager } from './tokens';\n\nconst TOOLBAR_CELLTYPE_CLASS = 'jp-Notebook-toolbarCellType';\nconst TOOLBAR_CELLTYPE_DROPDOWN_CLASS = 'jp-Notebook-toolbarCellTypeDropdown';\nconst PROMPT_METADATA_KEY = 'jupyvibe';\nconst PROMPT_CELL_CLASS = 'jupyvibe-prompt-cell';\n\ninterface PromptMetadata {\n  isPromptCell: boolean;\n  model?: string;\n}\n\n/**\n * Extended cell type that includes 'prompt'.\n */\ntype ExtendedCellType = nbformat.CellType | 'prompt';\n\n/**\n * Custom cell type switcher widget with Prompt option.\n */\nexport class CustomCellTypeSwitcher extends ReactWidget {\n  private _notebook: Notebook;\n  private _trans: ReturnType<ITranslator['load']>;\n\n  constructor(\n    panel: NotebookPanel,\n    _promptCellManager: IPromptCellManager,\n    translator?: ITranslator\n  ) {\n    super();\n    this._trans = (translator ?? nullTranslator).load('jupyterlab');\n    this.addClass(TOOLBAR_CELLTYPE_CLASS);\n    this._notebook = panel.content;\n\n    if (this._notebook.model) {\n      this.update();\n    }\n    this._notebook.activeCellChanged.connect(this.update, this);\n    this._notebook.selectionChanged.connect(this.update, this);\n\n    // Clean up on dispose\n    panel.disposed.connect(() => {\n      this._notebook.activeCellChanged.disconnect(this.update, this);\n      this._notebook.selectionChanged.disconnect(this.update, this);\n    });\n  }\n\n  /**\n   * Handle cell type change from dropdown.\n   */\n  handleChange = (event: React.ChangeEvent<HTMLSelectElement>): void => {\n    const newType = event.target.value as ExtendedCellType;\n    if (newType === '-') {\n      return;\n    }\n\n    if (newType === 'prompt') {\n      this._convertToPrompt();\n    } else {\n      // Remove prompt metadata if converting away from prompt\n      this._removePromptMetadata();\n      NotebookActions.changeCellType(this._notebook, newType as nbformat.CellType);\n    }\n    this._notebook.activate();\n  };\n\n  /**\n   * Handle keyboard navigation.\n   */\n  handleKeyDown = (event: React.KeyboardEvent): void => {\n    if (event.key === 'Enter') {\n      this._notebook.activate();\n    }\n  };\n\n  /**\n   * Convert selected cells to prompt type.\n   */\n  private _convertToPrompt(): void {\n    const notebook = this._notebook;\n    if (!notebook.model) {\n      return;\n    }\n\n    // Collect indices of cells to convert (don't modify during iteration)\n    const indicesToConvert: number[] = [];\n    notebook.widgets.forEach((cell, index) => {\n      if (!notebook.isSelectedOrActive(cell)) {\n        return;\n      }\n      // Check if already a prompt cell\n      const metadata = cell.model.getMetadata(PROMPT_METADATA_KEY) as PromptMetadata | undefined;\n      if (metadata?.isPromptCell) {\n        return;\n      }\n      indicesToConvert.push(index);\n    });\n\n    // Convert cells (process in reverse to preserve indices)\n    for (let i = indicesToConvert.length - 1; i >= 0; i--) {\n      const index = indicesToConvert[i];\n      const cell = notebook.widgets[index];\n      if (!cell) continue;\n\n      const needsTypeChange = cell.model.type !== 'markdown';\n      \n      // First change the cell type if needed (using NotebookActions for proper handling)\n      if (needsTypeChange) {\n        // Make this cell the active cell for NotebookActions\n        notebook.activeCellIndex = index;\n        notebook.deselectAll();\n        NotebookActions.changeCellType(notebook, 'markdown');\n      }\n      \n      // Now set the prompt metadata on the (possibly new) cell\n      const targetCell = notebook.widgets[index];\n      if (targetCell) {\n        targetCell.model.setMetadata(PROMPT_METADATA_KEY, {\n          isPromptCell: true,\n          model: 'claude-sonnet-4-20250514'\n        } as PromptMetadata);\n        \n        // Add prompt prefix if source is empty\n        const source = targetCell.model.sharedModel.getSource();\n        if (!source || !source.trim()) {\n          targetCell.model.sharedModel.setSource('**AI Prompt:** ');\n        }\n        \n        // Add styling class\n        if (!targetCell.hasClass(PROMPT_CELL_CLASS)) {\n          targetCell.addClass(PROMPT_CELL_CLASS);\n        }\n      }\n    }\n\n    notebook.deselectAll();\n  }\n\n  /**\n   * Remove prompt metadata from selected cells.\n   */\n  private _removePromptMetadata(): void {\n    const notebook = this._notebook;\n    \n    notebook.widgets.forEach((cell) => {\n      if (!notebook.isSelectedOrActive(cell)) {\n        return;\n      }\n\n      // Remove prompt metadata\n      const metadata = cell.model.getMetadata(PROMPT_METADATA_KEY) as PromptMetadata | undefined;\n      if (metadata?.isPromptCell) {\n        cell.model.deleteMetadata(PROMPT_METADATA_KEY);\n        cell.removeClass(PROMPT_CELL_CLASS);\n      }\n    });\n  }\n\n  /**\n   * Get the current cell type value for the dropdown.\n   */\n  private _getValue(): ExtendedCellType | '-' {\n    const notebook = this._notebook;\n    \n    if (!notebook.activeCell) {\n      return '-';\n    }\n\n    // Check if active cell is a prompt cell\n    let value: ExtendedCellType | '-' = this._isPromptCell(notebook.activeCell.model) \n      ? 'prompt' \n      : notebook.activeCell.model.type;\n\n    // Check all selected cells for consistency\n    for (const widget of notebook.widgets) {\n      if (notebook.isSelectedOrActive(widget)) {\n        const cellType = this._isPromptCell(widget.model) ? 'prompt' : widget.model.type;\n        if (cellType !== value) {\n          return '-';\n        }\n      }\n    }\n\n    return value;\n  }\n\n  /**\n   * Check if a cell model is a prompt cell.\n   */\n  private _isPromptCell(model: { getMetadata: (key: string) => unknown }): boolean {\n    const metadata = model.getMetadata(PROMPT_METADATA_KEY) as PromptMetadata | undefined;\n    return metadata?.isPromptCell === true;\n  }\n\n  render(): JSX.Element {\n    const value = this._getValue();\n\n    return (\n      <select\n        className={TOOLBAR_CELLTYPE_DROPDOWN_CLASS}\n        onChange={this.handleChange}\n        onKeyDown={this.handleKeyDown}\n        value={value}\n        aria-label={this._trans.__('Cell type')}\n        title={this._trans.__('Select the cell type')}\n      >\n        <option value=\"-\">-</option>\n        <option value=\"code\">{this._trans.__('Code')}</option>\n        <option value=\"markdown\">{this._trans.__('Markdown')}</option>\n        <option value=\"raw\">{this._trans.__('Raw')}</option>\n        <option value=\"prompt\">{this._trans.__('Prompt')}</option>\n      </select>\n    );\n  }\n}\n","/**\n * AI-powered Jupyter Lab extension with prompt cells.\n * \n * Features:\n * - $variable syntax to reference kernel variables in prompts\n * - &function syntax to give AI access to kernel functions as tools\n * - Prompt cells that see all preceding cells and kernel state\n */\n\nimport {\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin\n} from '@jupyterlab/application';\n\nimport { INotebookTracker, NotebookPanel, INotebookWidgetFactory, NotebookWidgetFactory } from '@jupyterlab/notebook';\nimport { ICommandPalette, ToolbarButton, IToolbarWidgetRegistry } from '@jupyterlab/apputils';\nimport { IMainMenu } from '@jupyterlab/mainmenu';\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport { ITranslator } from '@jupyterlab/translation';\nimport { addIcon } from '@jupyterlab/ui-components';\nimport { PromptCellManager } from './promptCell';\nimport { KernelConnector } from './kernelConnector';\nimport { SettingsManager } from './settings';\nimport { CustomCellTypeSwitcher } from './cellTypeSwitcher';\nimport { ModelPickerWidget } from './modelPicker';\nimport {\n  IPromptCellManager,\n  IExtensionSettings,\n  IKernelConnectorFactory\n} from './tokens';\n\nconst PLUGIN_ID = 'jupyvibe:plugin';\n\n/**\n * Settings plugin that provides IExtensionSettings.\n */\nconst settingsPlugin: JupyterFrontEndPlugin<IExtensionSettings> = {\n  id: 'jupyvibe:settings',\n  description: 'Provides Jupyvibe extension settings',\n  autoStart: true,\n  requires: [],\n  optional: [ISettingRegistry],\n  provides: IExtensionSettings,\n  activate: async (\n    app: JupyterFrontEnd,\n    settingRegistry: ISettingRegistry | null\n  ): Promise<IExtensionSettings> => {\n    const settingsManager = new SettingsManager();\n    \n    if (settingRegistry) {\n      await settingsManager.initialize(settingRegistry);\n      console.log('[jupyvibe] Settings loaded:', settingsManager.toJSON());\n    } else {\n      console.log('[jupyvibe] No setting registry available, using defaults');\n    }\n    \n    return settingsManager;\n  }\n};\n\n/**\n * Kernel connector factory plugin.\n */\nconst kernelConnectorPlugin: JupyterFrontEndPlugin<IKernelConnectorFactory> = {\n  id: 'jupyvibe:kernel-connector',\n  description: 'Provides kernel connector factory',\n  autoStart: true,\n  provides: IKernelConnectorFactory,\n  activate: (): IKernelConnectorFactory => {\n    return {\n      create: (sessionContext: unknown) => new KernelConnector(sessionContext as import('@jupyterlab/apputils').ISessionContext)\n    };\n  }\n};\n\n/**\n * Prompt cell manager plugin.\n */\nconst promptCellManagerPlugin: JupyterFrontEndPlugin<IPromptCellManager> = {\n  id: 'jupyvibe:prompt-cell-manager',\n  description: 'Manages AI prompt cells',\n  autoStart: true,\n  requires: [IExtensionSettings],\n  provides: IPromptCellManager,\n  activate: (\n    app: JupyterFrontEnd,\n    settings: IExtensionSettings\n  ): IPromptCellManager => {\n    const manager = new PromptCellManager();\n    manager.setSettings(settings);\n    return manager;\n  }\n};\n\n/**\n * Main plugin that sets up commands and UI.\n */\nconst mainPlugin: JupyterFrontEndPlugin<void> = {\n  id: PLUGIN_ID,\n  description: 'AI-powered prompt cells for JupyterLab',\n  autoStart: true,\n  requires: [INotebookTracker, IPromptCellManager, IKernelConnectorFactory, IExtensionSettings],\n  optional: [ICommandPalette, IMainMenu],\n  activate: (\n    app: JupyterFrontEnd,\n    notebookTracker: INotebookTracker,\n    promptCellManager: IPromptCellManager,\n    connectorFactory: IKernelConnectorFactory,\n    settings: IExtensionSettings,\n    palette: ICommandPalette | null,\n    mainMenu: IMainMenu | null\n  ) => {\n    console.log('Jupyvibe extension activated');\n\n    // Command to insert a new prompt cell\n    const insertPromptCommand = 'jupyvibe:insert-prompt-cell';\n    app.commands.addCommand(insertPromptCommand, {\n      label: 'Insert AI Prompt Cell',\n      caption: 'Insert a new AI prompt cell below the current cell',\n      execute: () => {\n        const panel = notebookTracker.currentWidget;\n        if (!panel) {\n          return;\n        }\n        promptCellManager.insertPromptCell(panel);\n      }\n    });\n\n    // Command to run prompt cell\n    const runPromptCommand = 'jupyvibe:run-prompt';\n    app.commands.addCommand(runPromptCommand, {\n      label: 'Run AI Prompt',\n      caption: 'Execute the current prompt cell',\n      execute: async () => {\n        const panel = notebookTracker.currentWidget;\n        if (!panel) {\n          return;\n        }\n        await promptCellManager.executePromptCell(panel);\n      }\n    });\n\n    // Add keyboard shortcuts\n    app.commands.addKeyBinding({\n      command: insertPromptCommand,\n      keys: ['Accel Shift P'],\n      selector: '.jp-Notebook'\n    });\n\n    // \"P\" in command mode inserts prompt cell (like \"M\" for markdown, \"Y\" for code)\n    app.commands.addKeyBinding({\n      command: insertPromptCommand,\n      keys: ['P'],\n      selector: '.jp-Notebook.jp-mod-commandMode:not(.jp-mod-readWrite) :focus'\n    });\n\n    // Shift+Enter on prompt cells runs AI instead of normal execution\n    app.commands.addKeyBinding({\n      command: runPromptCommand,\n      keys: ['Shift Enter'],\n      selector: '.jp-Notebook.jp-mod-editMode .jp-Cell.jupyvibe-prompt-cell'\n    });\n\n    app.commands.addKeyBinding({\n      command: runPromptCommand,\n      keys: ['Shift Enter'],\n      selector: '.jp-Notebook.jp-mod-commandMode .jp-Cell.jp-mod-selected.jupyvibe-prompt-cell'\n    });\n\n    // Add to command palette\n    if (palette) {\n      palette.addItem({\n        command: insertPromptCommand,\n        category: 'AI'\n      });\n      palette.addItem({\n        command: runPromptCommand,\n        category: 'AI'\n      });\n    }\n\n    // Add to Edit menu\n    if (mainMenu) {\n      mainMenu.editMenu.addGroup([\n        { command: insertPromptCommand },\n        { command: runPromptCommand }\n      ], 20);\n    }\n\n    // Helper to set up a notebook panel\n    const setupPanel = (panel: NotebookPanel) => {\n      const doSetup = () => {\n        // Skip if notebook was closed before context became ready\n        if (panel.isDisposed) {\n          return;\n        }\n        \n        // Add toolbar button for inserting prompt cells\n        const button = new ToolbarButton({\n          icon: addIcon,\n          onClick: () => {\n            promptCellManager.insertPromptCell(panel);\n          },\n          tooltip: 'Insert AI Prompt Cell (Cmd/Ctrl+Shift+P)',\n          label: 'AI Prompt'\n        });\n        panel.toolbar.insertAfter('cellType', 'jupyvibe-insert', button);\n        \n        // Add model picker to toolbar\n        const modelPicker = new ModelPickerWidget(settings);\n        panel.toolbar.insertAfter('jupyvibe-insert', 'jupyvibe-model-picker', modelPicker);\n        \n        // Use requestAnimationFrame to wait for cells to be rendered\n        requestAnimationFrame(() => {\n          if (panel.isDisposed) {\n            return;\n          }\n          const connector = connectorFactory.create(panel.sessionContext);\n          promptCellManager.setupNotebook(panel, connector);\n        });\n      };\n      if (panel.context.isReady) {\n        doSetup();\n      } else {\n        panel.context.ready.then(doSetup);\n      }\n    };\n\n    // Track new notebooks\n    notebookTracker.widgetAdded.connect((_, panel) => setupPanel(panel));\n\n    // Process existing notebooks\n    notebookTracker.forEach(setupPanel);\n  }\n};\n\n/**\n * Plugin that replaces the cell type dropdown with one that includes \"Prompt\".\n */\nconst cellTypeSwitcherPlugin: JupyterFrontEndPlugin<void> = {\n  id: 'jupyvibe:cell-type-switcher',\n  description: 'Adds Prompt option to cell type dropdown',\n  autoStart: true,\n  requires: [IToolbarWidgetRegistry, IPromptCellManager, INotebookWidgetFactory],\n  optional: [ITranslator],\n  activate: (\n    app: JupyterFrontEnd,\n    toolbarRegistry: IToolbarWidgetRegistry,\n    promptCellManager: IPromptCellManager,\n    _notebookWidgetFactory: NotebookWidgetFactory.IFactory,\n    translator: ITranslator | null\n  ) => {\n    console.log('[jupyvibe] Registering custom cell type switcher (after notebook widget factory)');\n    \n    const oldFactory = toolbarRegistry.addFactory<NotebookPanel>(\n      'Notebook',\n      'cellType',\n      (panel: NotebookPanel) => {\n        console.log('[jupyvibe] Creating CustomCellTypeSwitcher for panel:', panel.id);\n        return new CustomCellTypeSwitcher(panel, promptCellManager, translator ?? undefined);\n      }\n    );\n    \n    console.log('[jupyvibe] Replaced cellType factory, old factory was:', oldFactory ? 'present' : 'none');\n  }\n};\n\nexport default [settingsPlugin, kernelConnectorPlugin, promptCellManagerPlugin, cellTypeSwitcherPlugin, mainPlugin];\n","/**\n * Kernel connector for variable and function introspection.\n */\n\nimport { ISessionContext } from '@jupyterlab/apputils';\nimport { KernelMessage } from '@jupyterlab/services';\nimport {\n  IKernelConnector,\n  IKernelConnectorFactory,\n  IVariableInfo,\n  IFunctionInfo\n} from './tokens';\n\nexport type { IVariableInfo as VariableInfo, IFunctionInfo as FunctionInfo };\nexport type { IParameterInfo as ParameterInfo } from './tokens';\n\n/**\n * Connects to a Jupyter kernel to introspect variables and functions.\n * Implements IKernelConnector for dependency injection.\n */\nexport class KernelConnector implements IKernelConnector {\n  private _session: ISessionContext;\n\n  constructor(session: ISessionContext) {\n    this._session = session;\n  }\n\n  /**\n   * Check if the kernel is available.\n   */\n  get kernelAvailable(): boolean {\n    return !!this._session.session?.kernel;\n  }\n\n  /**\n   * Execute code silently and capture output.\n   */\n  async execute(\n    code: string,\n    onOutput?: (msg: KernelMessage.IIOPubMessage) => void\n  ): Promise<KernelMessage.IExecuteReplyMsg | null> {\n    const kernel = this._session.session?.kernel;\n    if (!kernel) {\n      return null;\n    }\n\n    const content: KernelMessage.IExecuteRequestMsg['content'] = {\n      code,\n      stop_on_error: false,\n      store_history: false,\n      silent: true\n    };\n\n    const future = kernel.requestExecute(content);\n\n    if (onOutput) {\n      future.onIOPub = onOutput;\n    }\n\n    try {\n      return (await future.done) as KernelMessage.IExecuteReplyMsg;\n    } finally {\n      future.dispose();\n    }\n  }\n\n  /**\n   * Execute code and return stdout output.\n   */\n  async executeAndCapture(code: string): Promise<string> {\n    let output = '';\n\n    await this.execute(code, (msg: KernelMessage.IIOPubMessage) => {\n      const msgType = msg.header.msg_type;\n      const content = msg.content as Record<string, unknown>;\n\n      if (msgType === 'stream' && content.name === 'stdout') {\n        output += content.text as string;\n      } else if (msgType === 'execute_result') {\n        const data = content.data as Record<string, string>;\n        if (data && data['text/plain']) {\n          output += data['text/plain'];\n        }\n      }\n    });\n\n    return output.trim();\n  }\n\n  /**\n   * Get the value of a variable by name.\n   */\n  async getVariable(name: string): Promise<IVariableInfo | null> {\n    const code = `\nimport json as _json_mod\ntry:\n    _var = ${name}\n    _result = {\n        \"name\": \"${name}\",\n        \"type\": type(_var).__name__,\n        \"repr\": repr(_var)[:500]\n    }\n    print(_json_mod.dumps(_result))\n    del _var, _result\nexcept Exception as _e:\n    print(_json_mod.dumps({\"error\": str(_e)}))\n`;\n\n    try {\n      const output = await this.executeAndCapture(code);\n      if (!output) {\n        return null;\n      }\n      const result = JSON.parse(output);\n      if (result.error) {\n        console.warn(`Error getting variable ${name}:`, result.error);\n        return null;\n      }\n      return result as IVariableInfo;\n    } catch (e) {\n      console.error(`Failed to get variable ${name}:`, e);\n      return null;\n    }\n  }\n\n  /**\n   * Get information about a function.\n   * Parses numpy/Google-style docstrings for parameter descriptions.\n   */\n  async getFunction(name: string): Promise<IFunctionInfo | null> {\n    const code = `\nimport json as _json_mod\nimport inspect as _inspect_mod\nimport re as _re_mod\ntry:\n    _func = ${name}\n    if not callable(_func):\n        print(_json_mod.dumps({\"error\": \"Not callable\"}))\n    else:\n        _sig = str(_inspect_mod.signature(_func))\n        _doc = _inspect_mod.getdoc(_func) or \"No documentation\"\n        \n        # Parse docstring for parameter descriptions (numpy/Google style)\n        _param_docs = {}\n        try:\n            _lines = _doc.splitlines()\n            _in_params_section = False\n            _current_param = None\n            _current_desc = []\n            \n            for _line in _lines:\n                _stripped = _line.strip()\n                _lower = _stripped.lower()\n                \n                # Detect section headers\n                if _lower in ('parameters', 'args', 'arguments', 'params'):\n                    _in_params_section = True\n                    continue\n                elif _lower in ('returns', 'return', 'raises', 'examples', 'notes', 'see also', 'attributes'):\n                    # End of parameters section\n                    if _current_param and _current_desc:\n                        _param_docs[_current_param] = ' '.join(_current_desc).strip()\n                    _in_params_section = False\n                    _current_param = None\n                    _current_desc = []\n                    continue\n                \n                if not _in_params_section:\n                    continue\n                \n                # Skip section underlines (numpy style)\n                if _stripped and all(c == '-' for c in _stripped):\n                    continue\n                \n                # Check if this is a new parameter line\n                # Numpy style: \"param : type\" or \"param: type\"\n                # Google style: \"param (type): description\" or \"param: description\"\n                _param_match = _re_mod.match(r'^(\\\\w+)\\\\s*(?:\\\\(.*?\\\\))?\\\\s*:(.*)$', _stripped)\n                if _param_match and not _line.startswith(' ' * 4) or (_param_match and _line and _line[0] not in ' \\\\t'):\n                    # Save previous param\n                    if _current_param and _current_desc:\n                        _param_docs[_current_param] = ' '.join(_current_desc).strip()\n                    \n                    _current_param = _param_match.group(1)\n                    _rest = _param_match.group(2).strip()\n                    _current_desc = [_rest] if _rest else []\n                elif _current_param and _stripped:\n                    # Continuation line\n                    _current_desc.append(_stripped)\n            \n            # Save last param\n            if _current_param and _current_desc:\n                _param_docs[_current_param] = ' '.join(_current_desc).strip()\n        except (AttributeError, TypeError, ValueError) as _parse_err:\n            # Docstring parsing is best-effort; fall back to empty on parse failures\n            _param_docs = {}\n        \n        _params = {}\n        for _pname, _param in _inspect_mod.signature(_func).parameters.items():\n            # Use parsed docstring description if available, otherwise use param name\n            _desc = _param_docs.get(_pname, _pname)\n            _pinfo = {\"type\": \"string\", \"description\": _desc}\n            if _param.annotation != _inspect_mod.Parameter.empty:\n                _ann = _param.annotation\n                if hasattr(_ann, '__name__'):\n                    _pinfo[\"type\"] = _ann.__name__\n                elif hasattr(_ann, '__origin__'):\n                    _pinfo[\"type\"] = str(_ann)\n            if _param.default != _inspect_mod.Parameter.empty:\n                _pinfo[\"default\"] = repr(_param.default)\n            _params[_pname] = _pinfo\n        # Extract return type annotation\n        _return_type = None\n        _ret_ann = _inspect_mod.signature(_func).return_annotation\n        if _ret_ann != _inspect_mod.Parameter.empty:\n            if hasattr(_ret_ann, '__name__'):\n                _return_type = _ret_ann.__name__\n            elif hasattr(_ret_ann, '__origin__'):\n                _return_type = str(_ret_ann)\n            else:\n                _return_type = str(_ret_ann)\n        \n        # Append return type to docstring (like toolslm pattern)\n        _full_doc = _doc[:500]\n        if _return_type:\n            _full_doc += f\"\\\\n\\\\nReturns:\\\\n- type: {_return_type}\"\n        \n        _result = {\n            \"name\": \"${name}\",\n            \"signature\": _sig,\n            \"docstring\": _full_doc,\n            \"parameters\": _params,\n            \"return_type\": _return_type\n        }\n        print(_json_mod.dumps(_result))\n        del _func, _sig, _doc, _params, _result, _param_docs\nexcept Exception as _e:\n    print(_json_mod.dumps({\"error\": str(_e)}))\n`;\n\n    try {\n      const output = await this.executeAndCapture(code);\n      if (!output) {\n        return null;\n      }\n      const result = JSON.parse(output);\n      if (result.error) {\n        console.warn(`Error getting function ${name}:`, result.error);\n        return null;\n      }\n      return result as IFunctionInfo;\n    } catch (e) {\n      console.error(`Failed to get function ${name}:`, e);\n      return null;\n    }\n  }\n}\n\n/**\n * Factory for creating KernelConnector instances.\n * Implements IKernelConnectorFactory for dependency injection.\n */\nexport class KernelConnectorFactory implements IKernelConnectorFactory {\n  create(sessionContext: ISessionContext): IKernelConnector {\n    return new KernelConnector(sessionContext);\n  }\n}\n","/**\n * Model picker component for selecting AI provider and model.\n */\n\nimport * as React from 'react';\nimport { useState, useEffect } from 'react';\nimport { ReactWidget } from '@jupyterlab/apputils';\nimport { URLExt } from '@jupyterlab/coreutils';\nimport { ServerConnection } from '@jupyterlab/services';\nimport { IExtensionSettings } from './tokens';\nimport { SettingsManager } from './settings';\n\ninterface ModelInfo {\n  id: string;\n  name: string;\n  date: string;\n}\n\ninterface ModelsResponse {\n  providers: Record<string, string>;\n  models: Record<string, ModelInfo[]>;\n}\n\ninterface ModelPickerProps {\n  settings: IExtensionSettings & { set?: SettingsManager['set'] };\n}\n\nconst PROVIDER_ORDER = ['anthropic', 'openai', 'gemini'];\n\nfunction ModelPickerComponent({ settings }: ModelPickerProps): JSX.Element {\n  const [providers, setProviders] = useState<Record<string, string>>({});\n  const [modelsByProvider, setModelsByProvider] = useState<Record<string, ModelInfo[]>>({});\n  const [selectedProvider, setSelectedProvider] = useState(settings.provider || 'anthropic');\n  const [selectedModel, setSelectedModel] = useState(settings.defaultModel || '');\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchModels = async () => {\n      try {\n        setLoading(true);\n        setError(null);\n        \n        const serverSettings = ServerConnection.makeSettings();\n        const url = URLExt.join(serverSettings.baseUrl, 'jupyvibe', 'models');\n        \n        const response = await ServerConnection.makeRequest(url, {}, serverSettings);\n        \n        if (!response.ok) {\n          throw new Error(`Failed to fetch models: ${response.status}`);\n        }\n        \n        const data: ModelsResponse = await response.json();\n        setProviders(data.providers);\n        setModelsByProvider(data.models);\n        \n        // If current model isn't in the list for the provider, select first available\n        const providerModels = data.models[settings.provider] || [];\n        if (providerModels.length > 0 && !providerModels.find(m => m.id === settings.defaultModel)) {\n          setSelectedModel(providerModels[0].id);\n        }\n      } catch (err) {\n        setError(err instanceof Error ? err.message : 'Failed to load models');\n      } finally {\n        setLoading(false);\n      }\n    };\n    \n    fetchModels();\n  }, [settings.provider, settings.defaultModel]);\n\n  const handleProviderChange = async (e: React.ChangeEvent<HTMLSelectElement>) => {\n    const newProvider = e.target.value;\n    setSelectedProvider(newProvider);\n    \n    // Select first model for new provider\n    const providerModels = modelsByProvider[newProvider] || [];\n    const newModel = providerModels.length > 0 ? providerModels[0].id : '';\n    setSelectedModel(newModel);\n    \n    // Save to settings\n    if (settings.set) {\n      await settings.set('provider', newProvider);\n      if (newModel) {\n        await settings.set('defaultModel', newModel);\n      }\n    }\n  };\n\n  const handleModelChange = async (e: React.ChangeEvent<HTMLSelectElement>) => {\n    const newModel = e.target.value;\n    setSelectedModel(newModel);\n    \n    // Save to settings\n    if (settings.set) {\n      await settings.set('defaultModel', newModel);\n    }\n  };\n\n  if (loading) {\n    return <span className=\"jupyvibe-model-picker-loading\">Loading...</span>;\n  }\n\n  if (error) {\n    return (\n      <span className=\"jupyvibe-model-picker-error\" title={error}>\n         Error\n      </span>\n    );\n  }\n\n  const currentModels = modelsByProvider[selectedProvider] || [];\n\n  return (\n    <div className=\"jupyvibe-model-picker\">\n      <select\n        className=\"jupyvibe-provider-select\"\n        value={selectedProvider}\n        onChange={handleProviderChange}\n        title=\"Select AI Provider\"\n      >\n        {PROVIDER_ORDER.filter(p => p in providers).map(providerId => (\n          <option key={providerId} value={providerId}>\n            {providers[providerId]}\n          </option>\n        ))}\n      </select>\n      <select\n        className=\"jupyvibe-model-select\"\n        value={selectedModel}\n        onChange={handleModelChange}\n        title=\"Select Model\"\n      >\n        {currentModels.map(model => (\n          <option key={model.id} value={model.id}>\n            {model.name}\n          </option>\n        ))}\n      </select>\n    </div>\n  );\n}\n\nexport class ModelPickerWidget extends ReactWidget {\n  private _settings: IExtensionSettings & { set?: SettingsManager['set'] };\n\n  constructor(settings: IExtensionSettings) {\n    super();\n    this._settings = settings as IExtensionSettings & { set?: SettingsManager['set'] };\n    this.addClass('jupyvibe-model-picker-widget');\n  }\n\n  render(): JSX.Element {\n    return <ModelPickerComponent settings={this._settings} />;\n  }\n}\n","/**\n * Prompt cell management and execution.\n */\n\nimport { NotebookPanel, NotebookActions } from '@jupyterlab/notebook';\nimport { Cell, ICellModel, MarkdownCell } from '@jupyterlab/cells';\nimport { ICodeCellModel, isCodeCellModel } from '@jupyterlab/cells';\nimport type {\n  IPromptCellManager,\n  IKernelConnector,\n  IPromptModel,\n  IPromptContext,\n  IVariableInfo,\n  IFunctionInfo,\n  IExtensionSettings,\n  IImageContext,\n  IChartSpec,\n  IConversationTurn\n} from './tokens';\nimport { parsePrompt, processPrompt } from './promptParser';\nimport { PromptModel } from './promptModel';\n\n/** Supported image MIME types for multimodal context */\nconst IMAGE_MIME_TYPES = ['image/png', 'image/jpeg', 'image/gif'] as const;\ntype ImageMimeType = (typeof IMAGE_MIME_TYPES)[number];\n\n/** MIME type patterns for declarative chart specs */\nconst VEGALITE_MIME_PATTERN = /^application\\/vnd\\.vegalite\\.v\\d+\\+json$/;\nconst PLOTLY_MIME = 'application/vnd.plotly.v1+json';\n\nconst PROMPT_CELL_CLASS = 'jupyvibe-prompt-cell';\nconst PROMPT_OUTPUT_CLASS = 'jupyvibe-prompt-output';\nconst PROMPT_METADATA_KEY = 'jupyvibe';\n\ninterface PromptMetadata {\n  isPromptCell?: boolean;\n  isOutputCell?: boolean;\n  model?: string;\n}\n\n/**\n * Manages prompt cells within notebooks.\n * Implements IPromptCellManager for dependency injection.\n */\nexport class PromptCellManager implements IPromptCellManager {\n  private _connectors: Map<string, IKernelConnector> = new Map();\n  private _settings: IExtensionSettings | null = null;\n\n  /**\n   * Set the settings instance.\n   */\n  setSettings(settings: IExtensionSettings): void {\n    this._settings = settings;\n  }\n\n  /**\n   * Set up a notebook for prompt cell handling.\n   */\n  setupNotebook(panel: NotebookPanel, connector: IKernelConnector): void {\n    const notebookId = panel.id;\n    this._connectors.set(notebookId, connector);\n\n    const notebook = panel.content;\n    \n    // Style all prompt and output cells - works with JupyterLab 4 windowing\n    const stylePromptCells = () => {\n      if (panel.isDisposed || !notebook.model) {\n        return;\n      }\n      const cellCount = notebook.model.cells.length;\n      \n      for (let i = 0; i < cellCount; i++) {\n        const cellModel = notebook.model.cells.get(i);\n        const cell = notebook.widgets[i];\n        if (!cell) {\n          continue;\n        }\n        \n        if (this._isPromptCellModel(cellModel)) {\n          if (!cell.hasClass(PROMPT_CELL_CLASS)) {\n            cell.addClass(PROMPT_CELL_CLASS);\n          }\n        }\n        \n        if (this._isOutputCellModel(cellModel)) {\n          if (!cell.hasClass(PROMPT_OUTPUT_CLASS)) {\n            cell.addClass(PROMPT_OUTPUT_CLASS);\n          }\n          // Restore \"Convert to Cells\" button if settings allow\n          if (this._settings?.showConvertButton !== false) {\n            const content = cellModel.getMetadata('jupyvibe_content') as string | undefined;\n            if (content && cell.model.type === 'markdown') {\n              this._addConvertButton(panel, cell as MarkdownCell, content);\n            }\n          }\n        }\n      }\n    };\n\n    // Initial styling\n    stylePromptCells();\n\n    // Re-style when cells scroll into view (for windowing mode)\n    const onActiveCellChanged = () => {\n      stylePromptCells();\n    };\n    notebook.activeCellChanged.connect(onActiveCellChanged);\n\n    // Listen for cell changes to style new prompt cells\n    const cells = notebook.model?.cells;\n    const onCellsChanged = () => {\n      // Defer to allow widgets to be created\n      requestAnimationFrame(() => stylePromptCells());\n    };\n\n    if (cells) {\n      cells.changed.connect(onCellsChanged);\n    }\n\n    // Clean up when notebook is closed\n    panel.disposed.connect(() => {\n      this._connectors.delete(notebookId);\n      notebook.activeCellChanged.disconnect(onActiveCellChanged);\n      if (cells) {\n        cells.changed.disconnect(onCellsChanged);\n      }\n    });\n  }\n\n  /**\n   * Insert a new prompt cell below the active cell.\n   */\n  insertPromptCell(panel: NotebookPanel): void {\n    const notebook = panel.content;\n\n    // Insert a markdown cell below\n    NotebookActions.insertBelow(notebook);\n\n    const activeIndex = notebook.activeCellIndex;\n    const cell = notebook.widgets[activeIndex];\n    const model = cell.model;\n\n    // Mark as prompt cell (no model stored - always use current settings)\n    model.setMetadata(PROMPT_METADATA_KEY, {\n      isPromptCell: true\n    } as PromptMetadata);\n\n    // Change to markdown type for the prompt\n    if (notebook.model) {\n      const cellData = model.toJSON();\n      cellData.cell_type = 'markdown';\n      cellData.source = '**AI Prompt:** ';\n      notebook.model.sharedModel.deleteCell(activeIndex);\n      notebook.model.sharedModel.insertCell(activeIndex, cellData);\n    }\n\n    // Add styling class\n    const newCell = notebook.widgets[activeIndex];\n    newCell.addClass(PROMPT_CELL_CLASS);\n\n    // Focus the cell for editing\n    notebook.activeCellIndex = activeIndex;\n    notebook.mode = 'edit';\n  }\n\n  /**\n   * Execute the current prompt cell.\n   */\n  async executePromptCell(panel: NotebookPanel): Promise<void> {\n    const notebook = panel.content;\n    const activeCell = notebook.activeCell;\n\n    if (!activeCell || !this._isPromptCellModel(activeCell.model)) {\n      console.log('Not a prompt cell');\n      return;\n    }\n\n    const connector = this._connectors.get(panel.id);\n    if (!connector) {\n      console.error('No kernel connector found');\n      return;\n    }\n\n    // Get model from cell metadata or settings\n    const metadata = activeCell.model.getMetadata(PROMPT_METADATA_KEY) as PromptMetadata | undefined;\n    const defaultModel = this._settings?.defaultModel ?? 'claude-sonnet-4-20250514';\n    const model = metadata?.model || defaultModel;\n\n    // Get kernel ID for tool execution\n    const kernelId = panel.sessionContext.session?.kernel?.id;\n\n    // Get the prompt text\n    const promptText = activeCell.model.sharedModel.getSource();\n\n    // Remove the \"**AI Prompt:** \" prefix if present\n    const cleanPrompt = promptText.replace(/^\\*\\*AI Prompt:\\*\\*\\s*/i, '');\n\n    // Parse for variable and function references\n    const parsed = parsePrompt(cleanPrompt);\n\n    // Gather context\n    const context = await this._gatherContext(panel, connector, parsed);\n\n    // Process the prompt (substitute variables)\n    const variableValues: Record<string, string> = {};\n    for (const [name, info] of Object.entries(context.variables)) {\n      variableValues[name] = (info as IVariableInfo).repr;\n    }\n    const processedPrompt = processPrompt(cleanPrompt, variableValues);\n\n    // Insert output cell\n    const outputCell = this._insertOutputCell(panel, activeCell);\n\n    // Call the AI backend\n    await this._callAI(panel, processedPrompt, context, outputCell, model, kernelId);\n  }\n\n  /**\n   * Gather context for the prompt including preceding code and referenced items.\n   */\n  private async _gatherContext(\n    panel: NotebookPanel,\n    connector: IKernelConnector,\n    parsed: ReturnType<typeof parsePrompt>\n  ): Promise<IPromptContext> {\n    const notebook = panel.content;\n    const model = notebook.model;\n    const activeIndex = notebook.activeCellIndex;\n\n    // Get preceding code cells and extract images/chart specs from outputs\n    const precedingCode: string[] = [];\n    const images: IImageContext[] = [];\n    const chartSpecs: IChartSpec[] = [];\n\n    // Iterate over the model (not widgets) for robustness under windowing\n    if (model) {\n      for (let i = 0; i < activeIndex; i++) {\n        const cellModel = model.cells.get(i);\n        if (!cellModel) {\n          continue;\n        }\n\n        if (cellModel.type === 'code') {\n          precedingCode.push(cellModel.sharedModel.getSource());\n          // Extract images and chart specs from code cell outputs\n          if (isCodeCellModel(cellModel)) {\n            this._extractImagesFromCodeCell(cellModel, i, images);\n            this._extractChartSpecsFromCodeCell(cellModel, i, chartSpecs);\n          }\n        } else if (cellModel.type === 'markdown') {\n          // Extract images from markdown cell attachments\n          this._extractImagesFromMarkdownCell(cellModel, i, images);\n        }\n      }\n    }\n\n    // Get referenced variables\n    const variables: Record<string, IVariableInfo> = {};\n    for (const varName of parsed.variables) {\n      const info = await connector.getVariable(varName);\n      if (info) {\n        variables[varName] = info;\n      }\n    }\n\n    // Get referenced functions\n    const functions: Record<string, IFunctionInfo> = {};\n    for (const funcName of parsed.functions) {\n      const info = await connector.getFunction(funcName);\n      if (info) {\n        functions[funcName] = info;\n      }\n    }\n\n    const conversationHistory = this._gatherConversationHistory(panel, activeIndex);\n\n    return {\n      preceding_code: precedingCode.join('\\n\\n'),\n      variables,\n      functions,\n      images: images.length > 0 ? images : undefined,\n      chartSpecs: chartSpecs.length > 0 ? chartSpecs : undefined,\n      conversationHistory:\n        conversationHistory.length > 0 ? conversationHistory : undefined\n    };\n  }\n\n  /**\n   * Gather conversation history from previous prompt/response cell pairs.\n   * Looks for cells with PROMPT_CELL_CLASS followed by PROMPT_OUTPUT_CLASS.\n   */\n  private _gatherConversationHistory(\n    panel: NotebookPanel,\n    activeIndex: number\n  ): IConversationTurn[] {\n    const notebook = panel.content;\n    const model = notebook.model;\n    const history: IConversationTurn[] = [];\n\n    if (!model) {\n      return history;\n    }\n\n    let i = 0;\n    while (i < activeIndex) {\n      const cellModel = model.cells.get(i);\n      if (!cellModel) {\n        i++;\n        continue;\n      }\n\n      const cellWidget = notebook.widgets[i];\n      if (!cellWidget) {\n        i++;\n        continue;\n      }\n\n      if (cellWidget.hasClass(PROMPT_CELL_CLASS)) {\n        const promptText = cellModel.sharedModel.getSource();\n\n        const nextIndex = i + 1;\n        if (nextIndex < activeIndex) {\n          const nextWidget = notebook.widgets[nextIndex];\n          const nextModel = model.cells.get(nextIndex);\n\n          if (\n            nextWidget &&\n            nextModel &&\n            nextWidget.hasClass(PROMPT_OUTPUT_CLASS)\n          ) {\n            const responseText = nextModel.sharedModel.getSource();\n            history.push({\n              prompt: promptText,\n              response: responseText\n            });\n            i = nextIndex + 1;\n            continue;\n          }\n        }\n      }\n      i++;\n    }\n\n    return history;\n  }\n\n  /**\n   * Extract images from code cell outputs.\n   */\n  private _extractImagesFromCodeCell(\n    cellModel: ICodeCellModel,\n    cellIndex: number,\n    images: IImageContext[]\n  ): void {\n    const outputs = cellModel.outputs;\n    if (!outputs) {\n      return;\n    }\n\n    for (let j = 0; j < outputs.length; j++) {\n      const outputModel = outputs.get(j);\n      const data = outputModel.data;\n\n      // Check each supported image MIME type\n      for (const mimeType of IMAGE_MIME_TYPES) {\n        const imageData = data[mimeType];\n        if (imageData && typeof imageData === 'string') {\n          images.push({\n            data: imageData,\n            mimeType: mimeType as ImageMimeType,\n            source: 'output',\n            cellIndex\n          });\n          break; // Only take the first matching image type per output\n        }\n      }\n    }\n  }\n\n  /**\n   * Extract images from markdown cell attachments.\n   */\n  private _extractImagesFromMarkdownCell(\n    cellModel: ICellModel,\n    cellIndex: number,\n    images: IImageContext[]\n  ): void {\n    // Attachments are stored in cell metadata under 'attachments'\n    const attachments = cellModel.getMetadata('attachments') as\n      | Record<string, Record<string, string>>\n      | undefined;\n\n    if (!attachments) {\n      return;\n    }\n\n    // Iterate through each attachment\n    for (const [_filename, mimeData] of Object.entries(attachments)) {\n      if (!mimeData || typeof mimeData !== 'object') {\n        continue;\n      }\n\n      // Check each supported image MIME type\n      for (const mimeType of IMAGE_MIME_TYPES) {\n        const imageData = mimeData[mimeType];\n        if (imageData && typeof imageData === 'string') {\n          images.push({\n            data: imageData,\n            mimeType: mimeType as ImageMimeType,\n            source: 'attachment',\n            cellIndex\n          });\n          break; // Only take the first matching image type per attachment\n        }\n      }\n    }\n  }\n\n  /**\n   * Extract chart specs (Vega-Lite, Plotly) from code cell outputs.\n   */\n  private _extractChartSpecsFromCodeCell(\n    cellModel: ICodeCellModel,\n    cellIndex: number,\n    chartSpecs: IChartSpec[]\n  ): void {\n    const outputs = cellModel.outputs;\n    if (!outputs) {\n      return;\n    }\n\n    for (let j = 0; j < outputs.length; j++) {\n      const outputModel = outputs.get(j);\n      const data = outputModel.data;\n\n      // Check for Vega-Lite specs (Altair outputs)\n      for (const mimeType of Object.keys(data)) {\n        if (VEGALITE_MIME_PATTERN.test(mimeType)) {\n          const specData = data[mimeType];\n          if (specData && typeof specData === 'object') {\n            chartSpecs.push({\n              type: 'vega-lite',\n              spec: specData as Record<string, unknown>,\n              cellIndex\n            });\n          }\n          break;\n        }\n      }\n\n      // Check for Plotly specs\n      const plotlyData = data[PLOTLY_MIME];\n      if (plotlyData && typeof plotlyData === 'object') {\n        chartSpecs.push({\n          type: 'plotly',\n          spec: plotlyData as Record<string, unknown>,\n          cellIndex\n        });\n      }\n    }\n  }\n\n  /**\n   * Insert a markdown cell for the AI output.\n   * Always creates a new cell for each execution.\n   */\n  private _insertOutputCell(panel: NotebookPanel, promptCell: Cell): Cell {\n    const notebook = panel.content;\n    const promptIndex = notebook.widgets.indexOf(promptCell);\n\n    // Find where to insert - after the prompt cell and any existing output cells\n    let insertAfterIndex = promptIndex;\n    for (let i = promptIndex + 1; i < notebook.widgets.length; i++) {\n      if (notebook.widgets[i].hasClass(PROMPT_OUTPUT_CLASS)) {\n        insertAfterIndex = i;\n      } else {\n        break;\n      }\n    }\n\n    // Insert new markdown cell after the last output (or after prompt if none)\n    notebook.activeCellIndex = insertAfterIndex;\n    NotebookActions.insertBelow(notebook);\n\n    const outputIndex = insertAfterIndex + 1;\n    const outputCell = notebook.widgets[outputIndex];\n\n    // Set up as output cell\n    if (notebook.model) {\n      const cellData = outputCell.model.toJSON();\n      cellData.cell_type = 'markdown';\n      cellData.source = '<div class=\"jupyvibe-loading\">Generating response...</div>';\n      notebook.model.sharedModel.deleteCell(outputIndex);\n      notebook.model.sharedModel.insertCell(outputIndex, cellData);\n    }\n\n    const newOutputCell = notebook.widgets[outputIndex];\n    newOutputCell.addClass(PROMPT_OUTPUT_CLASS);\n    \n    // Mark as output cell in metadata for persistence across reload\n    newOutputCell.model.setMetadata(PROMPT_METADATA_KEY, { isOutputCell: true });\n\n    return newOutputCell;\n  }\n\n  /**\n   * Call the AI backend and stream the response using signal-based PromptModel.\n   */\n  private async _callAI(\n    panel: NotebookPanel,\n    prompt: string,\n    context: IPromptContext,\n    outputCell: Cell,\n    model: string,\n    kernelId: string | undefined\n  ): Promise<void> {\n    // Create or get a PromptModel for this execution\n    const promptModel = new PromptModel();\n\n    // Connect output changes to cell updates\n    const onOutputChanged = (_: IPromptModel, output: string) => {\n      if (!outputCell.isDisposed) {\n        outputCell.model.sharedModel.setSource(output);\n      }\n    };\n    promptModel.outputChanged.connect(onOutputChanged);\n\n    // Abort on cell disposal\n    const abortOnDispose = () => promptModel.abort();\n    outputCell.disposed.connect(abortOnDispose);\n\n    try {\n      const maxSteps = this._settings?.maxToolSteps ?? 5;\n      \n      await promptModel.executePrompt(prompt, context, {\n        model,\n        kernelId,\n        maxSteps\n      });\n\n      // Render markdown and add convert button\n      if (!outputCell.isDisposed && outputCell instanceof MarkdownCell) {\n        outputCell.rendered = true;\n        const showButton = this._settings?.showConvertButton ?? true;\n        if (showButton) {\n          this._addConvertButton(panel, outputCell, promptModel.output);\n        }\n      }\n    } catch (error: unknown) {\n      if (error instanceof Error && error.name === 'AbortError') {\n        return;\n      }\n      if (!outputCell.isDisposed) {\n        outputCell.model.sharedModel.setSource(\n          `**Error:** Failed to connect to AI backend.\\n\\n${String(error)}`\n        );\n        if (outputCell instanceof MarkdownCell) {\n          outputCell.rendered = true;\n        }\n      }\n    } finally {\n      promptModel.outputChanged.disconnect(onOutputChanged);\n      outputCell.disposed.disconnect(abortOnDispose);\n      (promptModel as PromptModel).dispose();\n    }\n  }\n\n  /**\n   * Check if a cell is a prompt cell.\n   */\n  isPromptCell(cell: Cell): boolean {\n    return this._isPromptCellModel(cell.model);\n  }\n\n  /**\n   * Check if a cell model is a prompt cell.\n   */\n  private _isPromptCellModel(model: ICellModel): boolean {\n    const metadata = model.getMetadata(PROMPT_METADATA_KEY) as PromptMetadata | undefined;\n    return metadata?.isPromptCell === true;\n  }\n\n  /**\n   * Check if a cell model is an AI output cell.\n   */\n  private _isOutputCellModel(model: ICellModel): boolean {\n    const metadata = model.getMetadata(PROMPT_METADATA_KEY) as PromptMetadata | undefined;\n    return metadata?.isOutputCell === true;\n  }\n\n  /**\n   * Add a \"Convert to Cells\" button to an AI response cell.\n   * Stores content in cell metadata and adds a persistent button.\n   */\n  private _addConvertButton(panel: NotebookPanel, cell: MarkdownCell, content: string): void {\n    // Store content in metadata for later retrieval\n    cell.model.setMetadata('jupyvibe_content', content);\n    \n    // Check if button already exists\n    const existingContainer = cell.node.querySelector('.jupyvibe-convert-button-container');\n    if (existingContainer) {\n      return;\n    }\n\n    // Create button container - append directly to cell node\n    const buttonContainer = document.createElement('div');\n    buttonContainer.className = 'jupyvibe-convert-button-container';\n\n    const button = document.createElement('button');\n    button.className = 'jp-mod-styled jupyvibe-convert-button';\n    button.innerHTML = '<span class=\"jp-ToolbarButtonComponent-icon\"></span><span class=\"jp-ToolbarButtonComponent-label\">Convert to Cells</span>';\n    button.title = 'Convert this response into separate code and markdown cells';\n\n    button.addEventListener('click', () => {\n      const storedContent = cell.model.getMetadata('jupyvibe_content') as string || content;\n      this._convertToCells(panel, cell, storedContent);\n    });\n\n    buttonContainer.appendChild(button);\n\n    // Append directly to cell node (most stable location)\n    cell.node.appendChild(buttonContainer);\n  }\n\n  /**\n   * Convert an AI response cell into native code and markdown cells.\n   */\n  private _convertToCells(panel: NotebookPanel, responseCell: Cell, content: string): void {\n    const notebook = panel.content;\n    const cellIndex = notebook.widgets.indexOf(responseCell);\n    \n    if (cellIndex < 0 || !notebook.model) {\n      console.log('[jupyvibe] Convert: invalid cell index or no model');\n      return;\n    }\n\n    console.log('[jupyvibe] Converting content:', content.substring(0, 200) + '...');\n\n    // Parse the content into blocks\n    const blocks = this._parseContentBlocks(content);\n    \n    console.log('[jupyvibe] Parsed blocks:', blocks.length, blocks.map(b => ({ type: b.type, len: b.content.length })));\n    \n    if (blocks.length === 0) {\n      console.log('[jupyvibe] No blocks parsed, keeping original cell');\n      return;\n    }\n\n    // Remove the response cell\n    notebook.model.sharedModel.deleteCell(cellIndex);\n\n    // Insert new cells in reverse order (so they end up in correct order)\n    for (let i = blocks.length - 1; i >= 0; i--) {\n      const block = blocks[i];\n      const cellData = {\n        cell_type: block.type === 'code' ? 'code' : 'markdown',\n        source: block.content,\n        metadata: {}\n      };\n      notebook.model.sharedModel.insertCell(cellIndex, cellData);\n    }\n    \n    console.log('[jupyvibe] Inserted', blocks.length, 'cells');\n  }\n\n  /**\n   * Parse markdown content into code and text blocks.\n   */\n  private _parseContentBlocks(content: string): Array<{ type: 'code' | 'markdown'; content: string; language?: string }> {\n    const blocks: Array<{ type: 'code' | 'markdown'; content: string; language?: string }> = [];\n    \n    // Normalize line endings\n    const normalizedContent = content.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n');\n    \n    // Regex to match fenced code blocks - handles:\n    // - Optional language specifier\n    // - Optional whitespace after language\n    // - Code content (non-greedy)\n    // - Closing ``` (may be preceded by newline or not)\n    const codeBlockRegex = /```(\\w*)[ \\t]*\\n?([\\s\\S]*?)\\n?```/g;\n    \n    let lastIndex = 0;\n    let match;\n\n    console.log('[jupyvibe] Parsing content, length:', normalizedContent.length);\n    console.log('[jupyvibe] Content starts with:', JSON.stringify(normalizedContent.substring(0, 100)));\n\n    while ((match = codeBlockRegex.exec(normalizedContent)) !== null) {\n      console.log('[jupyvibe] Found code block match at', match.index, 'language:', match[1], 'code length:', match[2].length);\n      \n      // Add any text before this code block\n      const textBefore = normalizedContent.slice(lastIndex, match.index).trim();\n      if (textBefore) {\n        blocks.push({ type: 'markdown', content: textBefore });\n      }\n\n      // Add the code block\n      const language = match[1] || 'python';\n      const code = match[2].trim();\n      if (code) {\n        blocks.push({ type: 'code', content: code, language });\n      }\n\n      lastIndex = match.index + match[0].length;\n    }\n\n    // Add any remaining text after the last code block\n    const remainingText = normalizedContent.slice(lastIndex).trim();\n    if (remainingText) {\n      blocks.push({ type: 'markdown', content: remainingText });\n    }\n\n    // If no code blocks found but content exists, return as single markdown block\n    if (blocks.length === 0 && normalizedContent.trim()) {\n      console.log('[jupyvibe] No code blocks found, returning as single markdown');\n      blocks.push({ type: 'markdown', content: normalizedContent.trim() });\n    }\n\n    return blocks;\n  }\n}\n","/**\n * Signal-based prompt model for streaming AI responses.\n * \n * Uses Lumino Signals for reactive updates, following jupyter-ai patterns.\n */\n\nimport { Signal, ISignal } from '@lumino/signaling';\nimport { PageConfig } from '@jupyterlab/coreutils';\nimport type {\n  IPromptModel,\n  IStreamEvent,\n  IPromptContext\n} from './tokens';\nimport { renderToolResult } from './toolResultRenderer';\n\n/**\n * Implementation of IPromptModel with signal-based streaming.\n */\nexport class PromptModel implements IPromptModel {\n  private _state: IPromptModel.ExecutionState = 'idle';\n  private _output = '';\n  private _abortController: AbortController | null = null;\n\n  private _streamEvent = new Signal<this, IStreamEvent>(this);\n  private _outputChanged = new Signal<this, string>(this);\n  private _stateChanged = new Signal<this, IPromptModel.ExecutionState>(this);\n\n  /**\n   * Signal emitted when streaming events occur.\n   */\n  get streamEvent(): ISignal<IPromptModel, IStreamEvent> {\n    return this._streamEvent;\n  }\n\n  /**\n   * Signal emitted when the accumulated output changes.\n   */\n  get outputChanged(): ISignal<IPromptModel, string> {\n    return this._outputChanged;\n  }\n\n  /**\n   * Signal emitted when execution state changes.\n   */\n  get stateChanged(): ISignal<IPromptModel, IPromptModel.ExecutionState> {\n    return this._stateChanged;\n  }\n\n  /**\n   * Current execution state.\n   */\n  get state(): IPromptModel.ExecutionState {\n    return this._state;\n  }\n\n  /**\n   * Current accumulated output text.\n   */\n  get output(): string {\n    return this._output;\n  }\n\n  /**\n   * Execute a prompt and stream the response.\n   */\n  async executePrompt(\n    prompt: string,\n    context: IPromptContext,\n    options: IPromptModel.IExecuteOptions\n  ): Promise<void> {\n    this._setState('executing');\n    this._output = '';\n    this._abortController = new AbortController();\n\n    this._emitEvent({ type: 'start' });\n\n    const baseUrl = PageConfig.getBaseUrl();\n    const body = {\n      prompt,\n      context,\n      model: options.model,\n      kernel_id: options.kernelId,\n      max_steps: options.maxSteps ?? 1\n    };\n\n    try {\n      const xsrfToken = document.cookie\n        .split('; ')\n        .find(row => row.startsWith('_xsrf='))\n        ?.split('=')[1];\n\n      const response = await fetch(`${baseUrl}jupyvibe/prompt`, {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(xsrfToken && { 'X-XSRFToken': xsrfToken })\n        },\n        body: JSON.stringify(body),\n        signal: this._abortController.signal\n      });\n\n      if (!response.ok) {\n        let errorMessage = `HTTP ${response.status}: ${response.statusText}`;\n        try {\n          const errorBody = await response.json();\n          if (errorBody.error) {\n            errorMessage = errorBody.error;\n          }\n        } catch {\n          // Response wasn't JSON\n        }\n        throw new Error(errorMessage);\n      }\n\n      this._setState('streaming');\n      await this._processStream(response);\n      this._setState('idle');\n    } catch (error: unknown) {\n      if (error instanceof Error && error.name === 'AbortError') {\n        this._setState('idle');\n        return;\n      }\n      this._emitEvent({\n        type: 'error',\n        error: error instanceof Error ? error.message : String(error)\n      });\n      this._setState('error');\n      throw error;\n    } finally {\n      this._abortController = null;\n    }\n  }\n\n  /**\n   * Process the SSE stream from the server.\n   */\n  private async _processStream(response: Response): Promise<void> {\n    const reader = response.body?.getReader();\n    if (!reader) {\n      throw new Error('No response body');\n    }\n\n    const decoder = new TextDecoder();\n    let buffer = '';\n    let currentToolCall: { name: string; id: string; input: string } | null = null;\n\n    try {\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        buffer += decoder.decode(value, { stream: true });\n\n        const lines = buffer.split('\\n');\n        buffer = lines.pop() || '';\n\n        for (const rawLine of lines) {\n          const line = rawLine.replace(/\\r$/, '');\n          if (!line.startsWith('data: ')) continue;\n\n          const data = line.slice(6);\n          try {\n            const event = JSON.parse(data);\n            this._handleServerEvent(event, currentToolCall);\n\n            // Track tool call state\n            if (event.tool_call) {\n              currentToolCall = {\n                name: event.tool_call.name,\n                id: event.tool_call.id,\n                input: ''\n              };\n            } else if (event.tool_input && currentToolCall) {\n              currentToolCall.input += event.tool_input;\n            } else if (event.tool_result) {\n              currentToolCall = null;\n            }\n          } catch {\n            // Ignore invalid JSON\n          }\n        }\n      }\n    } finally {\n      reader.releaseLock();\n    }\n\n    this._emitEvent({ type: 'done' });\n  }\n\n  /**\n   * Handle a server-sent event.\n   */\n  private _handleServerEvent(\n    event: Record<string, unknown>,\n    currentToolCall: { name: string; id: string; input: string } | null\n  ): void {\n    if (event.text) {\n      const text = event.text as string;\n      this._appendOutput(text);\n      this._emitEvent({ type: 'text', text });\n    } else if (event.error) {\n      const error = event.error as string;\n      this._appendOutput(`\\n\\n**Error:** ${error}\\n`);\n      this._emitEvent({ type: 'error', error });\n    } else if (event.tool_call) {\n      const toolCall = event.tool_call as { name: string; id: string };\n      this._appendOutput(`\\n\\n *Calling tool: \\`${toolCall.name}\\`...*\\n`);\n      this._emitEvent({\n        type: 'tool_call',\n        toolCall: { name: toolCall.name, id: toolCall.id }\n      });\n    } else if (event.tool_input) {\n      this._emitEvent({ type: 'tool_input', toolInput: event.tool_input as string });\n    } else if (event.tool_result) {\n      const tr = event.tool_result as { id: string; name: string; result: unknown };\n      const rendered = renderToolResult(tr.result);\n      this._appendOutput(rendered);\n      this._emitEvent({\n        type: 'tool_result',\n        toolResult: { id: tr.id, name: tr.name, result: tr.result }\n      });\n    }\n  }\n\n  /**\n   * Append text to output and emit change signal.\n   */\n  private _appendOutput(text: string): void {\n    this._output += text;\n    this._outputChanged.emit(this._output);\n  }\n\n  /**\n   * Abort the current execution.\n   */\n  abort(): void {\n    if (this._abortController) {\n      this._abortController.abort();\n      this._abortController = null;\n    }\n  }\n\n  /**\n   * Reset the model state.\n   */\n  reset(): void {\n    this.abort();\n    this._output = '';\n    this._setState('idle');\n    this._outputChanged.emit(this._output);\n  }\n\n  /**\n   * Set state and emit signal.\n   */\n  private _setState(state: IPromptModel.ExecutionState): void {\n    if (this._state !== state) {\n      this._state = state;\n      this._stateChanged.emit(state);\n    }\n  }\n\n  /**\n   * Emit a stream event.\n   */\n  private _emitEvent(event: IStreamEvent): void {\n    this._streamEvent.emit(event);\n  }\n\n  /**\n   * Dispose of the model.\n   */\n  dispose(): void {\n    this.abort();\n    Signal.clearData(this);\n  }\n}\n\n/**\n * Factory for creating PromptModel instances.\n */\nexport class PromptModelFactory {\n  create(): IPromptModel {\n    return new PromptModel();\n  }\n}\n","/**\n * Parser for $`variable` and &`function` syntax in prompts.\n */\n\nexport interface ParsedPrompt {\n  variables: string[];\n  functions: string[];\n}\n\n/**\n * Parse a prompt to extract variable and function references.\n * \n * - $`variableName` references a kernel variable\n * - &`functionName` makes a function available as an AI tool\n */\nexport function parsePrompt(text: string): ParsedPrompt {\n  // Match $`variableName` (word characters inside backticks after $)\n  const variablePattern = /\\$`([a-zA-Z_][a-zA-Z0-9_]*)`/g;\n  \n  // Match &`functionName` (word characters inside backticks after &)\n  const functionPattern = /&`([a-zA-Z_][a-zA-Z0-9_]*)`/g;\n\n  const variables: string[] = [];\n  const functions: string[] = [];\n\n  let match;\n\n  // Find all variable references\n  while ((match = variablePattern.exec(text)) !== null) {\n    const varName = match[1];\n    if (!variables.includes(varName)) {\n      variables.push(varName);\n    }\n  }\n\n  // Find all function references\n  while ((match = functionPattern.exec(text)) !== null) {\n    const funcName = match[1];\n    if (!functions.includes(funcName)) {\n      functions.push(funcName);\n    }\n  }\n\n  return {\n    variables,\n    functions\n  };\n}\n\n/**\n * Replace variable references in prompt with their values.\n * Uses a replacer function to safely handle $ and other special chars in values.\n */\nexport function substituteVariables(\n  text: string,\n  variableValues: Record<string, string>\n): string {\n  let result = text;\n  \n  for (const [name, value] of Object.entries(variableValues)) {\n    const pattern = new RegExp(`\\\\$\\`${name}\\``, 'g');\n    // Use replacer function to avoid interpreting $& etc. in value\n    result = result.replace(pattern, () => value);\n  }\n  \n  return result;\n}\n\n/**\n * Remove function references from the prompt text.\n * (They're used for tool definitions, not prompt content)\n * Also normalizes whitespace to avoid double spaces.\n */\nexport function removeFunctionReferences(text: string): string {\n  return text\n    .replace(/&`([a-zA-Z_][a-zA-Z0-9_]*)`/g, '')\n    .replace(/\\s+/g, ' ')\n    .trim();\n}\n\n/**\n * Get a cleaned prompt with variables substituted and function refs removed.\n */\nexport function processPrompt(\n  text: string,\n  variableValues: Record<string, string>\n): string {\n  let result = substituteVariables(text, variableValues);\n  result = removeFunctionReferences(result);\n  return result.trim();\n}\n","/**\n * Settings management for jupyvibe extension.\n * \n * Integrates with JupyterLab's ISettingRegistry for persistent configuration.\n */\n\nimport { ISettingRegistry } from '@jupyterlab/settingregistry';\nimport { Signal, ISignal } from '@lumino/signaling';\nimport { IExtensionSettings } from './tokens';\n\nconst PLUGIN_ID = 'jupyvibe:plugin';\n\n/**\n * Default settings values.\n */\nconst DEFAULT_SETTINGS: IExtensionSettings = {\n  provider: 'anthropic',\n  defaultModel: 'claude-sonnet-4-20250514',\n  maxToolSteps: 5,\n  showConvertButton: true\n};\n\n/**\n * Settings manager that wraps ISettingRegistry.\n */\nexport class SettingsManager implements IExtensionSettings {\n  private _settings: ISettingRegistry.ISettings | null = null;\n  private _provider: string = DEFAULT_SETTINGS.provider;\n  private _defaultModel: string = DEFAULT_SETTINGS.defaultModel;\n  private _maxToolSteps: number = DEFAULT_SETTINGS.maxToolSteps;\n  private _showConvertButton: boolean = DEFAULT_SETTINGS.showConvertButton;\n  private _settingsChanged = new Signal<this, void>(this);\n\n  /**\n   * Signal emitted when settings change.\n   */\n  get settingsChanged(): ISignal<this, void> {\n    return this._settingsChanged;\n  }\n\n  get provider(): string {\n    return this._provider;\n  }\n\n  get defaultModel(): string {\n    return this._defaultModel;\n  }\n\n  get maxToolSteps(): number {\n    return this._maxToolSteps;\n  }\n\n  get showConvertButton(): boolean {\n    return this._showConvertButton;\n  }\n\n  /**\n   * Initialize settings from the registry.\n   */\n  async initialize(registry: ISettingRegistry): Promise<void> {\n    try {\n      this._settings = await registry.load(PLUGIN_ID);\n      this._updateFromSettings();\n      this._settings.changed.connect(this._onSettingsChanged, this);\n    } catch (error) {\n      console.warn('[jupyvibe] Failed to load settings, using defaults:', error);\n    }\n  }\n\n  /**\n   * Update a setting value.\n   */\n  async set<K extends keyof IExtensionSettings>(\n    key: K,\n    value: IExtensionSettings[K]\n  ): Promise<void> {\n    if (this._settings) {\n      await this._settings.set(key, value);\n    }\n  }\n\n  /**\n   * Get all settings as a plain object.\n   */\n  toJSON(): IExtensionSettings {\n    return {\n      provider: this._provider,\n      defaultModel: this._defaultModel,\n      maxToolSteps: this._maxToolSteps,\n      showConvertButton: this._showConvertButton\n    };\n  }\n\n  private _onSettingsChanged(): void {\n    this._updateFromSettings();\n    this._settingsChanged.emit();\n  }\n\n  private _updateFromSettings(): void {\n    if (!this._settings) return;\n\n    const composite = this._settings.composite;\n    \n    this._provider =\n      (composite['provider'] as string) ?? DEFAULT_SETTINGS.provider;\n    this._defaultModel =\n      (composite['defaultModel'] as string) ?? DEFAULT_SETTINGS.defaultModel;\n    this._maxToolSteps =\n      (composite['maxToolSteps'] as number) ?? DEFAULT_SETTINGS.maxToolSteps;\n    this._showConvertButton =\n      (composite['showConvertButton'] as boolean) ?? DEFAULT_SETTINGS.showConvertButton;\n  }\n\n  /**\n   * Dispose of the settings manager.\n   */\n  dispose(): void {\n    if (this._settings) {\n      this._settings.changed.disconnect(this._onSettingsChanged, this);\n    }\n    Signal.clearData(this);\n  }\n}\n","/**\n * Dependency injection tokens for jupyvibe extension.\n * \n * Following JupyterLab's plugin architecture pattern, these tokens\n * allow loose coupling between components and enable testing/mocking.\n */\n\nimport { Token } from '@lumino/coreutils';\nimport { ISignal } from '@lumino/signaling';\nimport { NotebookPanel } from '@jupyterlab/notebook';\nimport { Cell } from '@jupyterlab/cells';\nimport { KernelMessage } from '@jupyterlab/services';\n\n/**\n * Variable information from kernel introspection.\n */\nexport interface IVariableInfo {\n  name: string;\n  type: string;\n  repr: string;\n  value?: unknown;\n}\n\n/**\n * Parameter information for function introspection.\n */\nexport interface IParameterInfo {\n  type: string;\n  description: string;\n  default?: string;\n}\n\n/**\n * Function information from kernel introspection.\n */\nexport interface IFunctionInfo {\n  name: string;\n  signature: string;\n  docstring: string;\n  parameters: Record<string, IParameterInfo>;\n  return_type?: string;\n}\n\n/**\n * Interface for kernel connector.\n * Provides kernel introspection and code execution capabilities.\n */\nexport interface IKernelConnector {\n  /**\n   * Whether the kernel is currently available.\n   */\n  readonly kernelAvailable: boolean;\n\n  /**\n   * Execute code silently and capture output.\n   */\n  execute(\n    code: string,\n    onOutput?: (msg: KernelMessage.IIOPubMessage) => void\n  ): Promise<KernelMessage.IExecuteReplyMsg | null>;\n\n  /**\n   * Execute code and return stdout output as string.\n   */\n  executeAndCapture(code: string): Promise<string>;\n\n  /**\n   * Get information about a variable in the kernel.\n   */\n  getVariable(name: string): Promise<IVariableInfo | null>;\n\n  /**\n   * Get information about a function in the kernel.\n   */\n  getFunction(name: string): Promise<IFunctionInfo | null>;\n}\n\n/**\n * Stream event types for prompt execution.\n */\nexport type StreamEventType =\n  | 'start'\n  | 'text'\n  | 'tool_call'\n  | 'tool_input'\n  | 'tool_result'\n  | 'error'\n  | 'done';\n\n/**\n * Stream event emitted during prompt execution.\n */\nexport interface IStreamEvent {\n  type: StreamEventType;\n  /** Text content for 'text' events */\n  text?: string;\n  /** Tool call info for 'tool_call' events */\n  toolCall?: {\n    name: string;\n    id: string;\n  };\n  /** Tool input JSON for 'tool_input' events */\n  toolInput?: string;\n  /** Tool result for 'tool_result' events */\n  toolResult?: {\n    id: string;\n    name: string;\n    result: unknown;\n  };\n  /** Error message for 'error' events */\n  error?: string;\n}\n\n/**\n * Image extracted from notebook cells for multimodal context.\n */\nexport interface IImageContext {\n  /** Base64 encoded image data */\n  data: string;\n  /** MIME type (image/png, image/jpeg, image/gif) */\n  mimeType: 'image/png' | 'image/jpeg' | 'image/gif';\n  /** Source of the image */\n  source: 'output' | 'attachment';\n  /** Cell index where the image was found */\n  cellIndex: number;\n}\n\n/**\n * Chart specification extracted from notebook cells for declarative viz context.\n * Supports Vega-Lite (Altair) and Plotly JSON specs.\n */\nexport interface IChartSpec {\n  /** Chart library type */\n  type: 'vega-lite' | 'plotly';\n  /** The JSON specification */\n  spec: Record<string, unknown>;\n  /** Cell index where the chart was found */\n  cellIndex: number;\n}\n\n/**\n * A single turn in the conversation history.\n */\nexport interface IConversationTurn {\n  /** The user's prompt text */\n  prompt: string;\n  /** The AI's response text */\n  response: string;\n}\n\n/**\n * Prompt execution context containing gathered information.\n */\nexport interface IPromptContext {\n  preceding_code: string;\n  variables: Record<string, IVariableInfo>;\n  functions: Record<string, IFunctionInfo>;\n  /** Images from preceding cells (outputs and markdown attachments) */\n  images?: IImageContext[];\n  /** Chart specs from preceding cells (Vega-Lite, Plotly) */\n  chartSpecs?: IChartSpec[];\n  /** Previous prompt/response pairs for conversation continuity */\n  conversationHistory?: IConversationTurn[];\n}\n\n/**\n * Interface for the prompt model.\n * Manages prompt state and emits streaming events.\n */\nexport interface IPromptModel {\n  /**\n   * Signal emitted when streaming events occur.\n   */\n  readonly streamEvent: ISignal<IPromptModel, IStreamEvent>;\n\n  /**\n   * Signal emitted when the accumulated output changes.\n   */\n  readonly outputChanged: ISignal<IPromptModel, string>;\n\n  /**\n   * Signal emitted when execution state changes.\n   */\n  readonly stateChanged: ISignal<IPromptModel, IPromptModel.ExecutionState>;\n\n  /**\n   * Current execution state.\n   */\n  readonly state: IPromptModel.ExecutionState;\n\n  /**\n   * Current accumulated output text.\n   */\n  readonly output: string;\n\n  /**\n   * Execute a prompt and stream the response.\n   */\n  executePrompt(\n    prompt: string,\n    context: IPromptContext,\n    options: IPromptModel.IExecuteOptions\n  ): Promise<void>;\n\n  /**\n   * Abort the current execution.\n   */\n  abort(): void;\n\n  /**\n   * Reset the model state.\n   */\n  reset(): void;\n}\n\nexport namespace IPromptModel {\n  export type ExecutionState = 'idle' | 'executing' | 'streaming' | 'error';\n\n  export interface IExecuteOptions {\n    model: string;\n    kernelId?: string;\n    maxSteps?: number;\n  }\n}\n\n/**\n * Interface for prompt cell manager.\n * Manages prompt cells within notebooks.\n */\nexport interface IPromptCellManager {\n  /**\n   * Set up a notebook for prompt cell handling.\n   */\n  setupNotebook(panel: NotebookPanel, connector: IKernelConnector): void;\n\n  /**\n   * Insert a new prompt cell below the current cell.\n   */\n  insertPromptCell(panel: NotebookPanel): void;\n\n  /**\n   * Execute the current prompt cell.\n   */\n  executePromptCell(panel: NotebookPanel): Promise<void>;\n\n  /**\n   * Check if a cell is a prompt cell.\n   */\n  isPromptCell(cell: Cell): boolean;\n}\n\n/**\n * Extension settings interface.\n */\nexport interface IExtensionSettings {\n  /**\n   * AI provider (openai, anthropic, gemini).\n   */\n  provider: string;\n\n  /**\n   * Default model to use for prompts.\n   */\n  defaultModel: string;\n\n  /**\n   * Maximum tool execution steps.\n   */\n  maxToolSteps: number;\n\n  /**\n   * Whether to show the convert to cells button.\n   */\n  showConvertButton: boolean;\n}\n\n/**\n * Token for the kernel connector factory.\n */\nexport const IKernelConnectorFactory = new Token<IKernelConnectorFactory>(\n  'jupyvibe:IKernelConnectorFactory',\n  'Factory for creating kernel connectors'\n);\n\nexport interface IKernelConnectorFactory {\n  /**\n   * Create a kernel connector for a session context.\n   */\n  create(sessionContext: unknown): IKernelConnector;\n}\n\n/**\n * Token for the prompt cell manager.\n */\nexport const IPromptCellManager = new Token<IPromptCellManager>(\n  'jupyvibe:IPromptCellManager',\n  'Manages prompt cells within notebooks'\n);\n\n/**\n * Token for the prompt model factory.\n */\nexport const IPromptModelFactory = new Token<IPromptModelFactory>(\n  'jupyvibe:IPromptModelFactory',\n  'Factory for creating prompt models'\n);\n\nexport interface IPromptModelFactory {\n  /**\n   * Create a new prompt model instance.\n   */\n  create(): IPromptModel;\n}\n\n/**\n * Token for extension settings.\n */\nexport const IExtensionSettings = new Token<IExtensionSettings>(\n  'jupyvibe:IExtensionSettings',\n  'Extension configuration settings'\n);\n","/**\n * Utility functions for rendering tool results as markdown.\n */\n\nexport interface ToolResult {\n  type?: string;\n  content?: string;\n  format?: string;\n  status?: string;\n  error?: string;\n}\n\n/**\n * Render a structured tool result into markdown.\n */\nexport function renderToolResult(result: unknown): string {\n  if (!result || typeof result !== 'object') {\n    return `\\n**Tool Result:** ${JSON.stringify(result)}\\n`;\n  }\n\n  const resultObj = result as ToolResult;\n  \n  // Handle error status\n  if (resultObj.status === 'error' || resultObj.error) {\n    return `\\n**Tool Error:** ${resultObj.error || 'Unknown error'}\\n`;\n  }\n\n  const type = resultObj.type;\n  const content = resultObj.content ?? '';\n\n  if (type === 'text') {\n    return `\\n**Tool Result:**\\n\\`\\`\\`\\n${content}\\n\\`\\`\\`\\n`;\n  }\n\n  if (type === 'html') {\n    // Raw HTML is allowed in Jupyter markdown\n    return `\\n**Tool Result (HTML):**\\n\\n${content}\\n`;\n  }\n\n  if (type === 'image') {\n    const format = resultObj.format || 'png';\n    return `\\n**Tool Result:**\\n\\n![](data:image/${format};base64,${content})\\n`;\n  }\n\n  // Fallback\n  return `\\n**Tool Result:**\\n\\`\\`\\`json\\n${JSON.stringify(result, null, 2)}\\n\\`\\`\\`\\n`;\n}\n"],"names":[],"ignoreList":[],"sourceRoot":""}